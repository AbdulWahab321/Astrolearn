{% extends 'base.html' %}

{% block title %}{{ chapter.split("_",maxsplit=1)[1].replace('_',' ') }}{% endblock %}
{% block head %}
{% endblock %}
{% block content %}
    <div class="chapter-body">
        <h3 class="text-4xl font-bold mb-8 text-center text-primary-light dark:text-primary-dark chapter-heading" style="text-align: center;font-size: 1.7rem !important;margin-bottom: -10px;">Chapter: {{ chapter.split("_",maxsplit=1)[0].replace('_',' ') }}</h3>
    <h1 class="text-4xl font-bold mb-8 text-center text-primary-light dark:text-primary-dark chapter-heading">{{ chapter.split("_",maxsplit=1)[1].replace('_',' ') }}</h1>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8 chapter-content" >
        <div class="prose max-w-none text-text-light dark:text-text-dark markdown-content">
            {{ content|safe }}
        </div>
    </div>
 <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <div id="flashcard-container" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hidden">
        <h2 class="text-2xl font-bold mb-4 text-primary-light dark:text-primary-dark">Flashcards</h2>
        <div class="flashcard">
            <div id="question" class="text-xl"></div>
            <div id="answer" class="hidden text-xl"></div>
        </div>
        <div class="flex justify-center space-x-4">
            <button id="flip-btn" class="bg-primary-light dark:bg-primary-dark text-white py-2 px-4 rounded hover:bg-opacity-80 transition duration-300 btn">Flip</button>
            <button id="next-btn" class="bg-primary-light dark:bg-primary-dark text-white py-2 px-4 rounded hover:bg-opacity-80 transition duration-300 btn">Next</button>
        </div>
    </div>

    </div>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // Q&A functionality
    var buttons = document.querySelectorAll(".q_and_a_button");
    buttons.forEach(function (button) {
        button.addEventListener("click", function () {
            var answer = this.parentElement.querySelector('.q_and_a_answer');
            if (!answer) {
                return;
            }
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                this.textContent = "Show Answer";
                answer.style.maxHeight = null;
                answer.style.opacity = 0;
                answer.style.padding = 0;
            } else {
                answer.classList.add('show');
                this.textContent = "Hide Answer";
                answer.style.maxHeight = answer.scrollHeight + "10px";
                answer.style.opacity = 1;
                answer.style.padding = "10px";
            }
        });
    });

    const flashcardContainer = document.getElementById('flashcard-container');
    if (flashcardContainer) {
        const flashcard = document.querySelector('.flashcard');
        const question = document.getElementById('question');
        const answer = document.getElementById('answer');
        const flipBtn = document.getElementById('flip-btn');
        const nextBtn = document.getElementById('next-btn');

        // Parsing the flashcards JSON data
        const flashcards = JSON.parse({{ flashcards|tojson|safe }});
        console.log(flashcards);
        let currentCard = 0;

        function showCard() {
            question.textContent = flashcards[currentCard].question;
            answer.textContent = flashcards[currentCard].answer;
            answer.classList.add('hidden');
            if (flashcards[currentCard].image) {
                answer.innerHTML += `<br><img src="${flashcards[currentCard].image}" alt="Diagram" class="flashcard-image"/>`;
            }
            flashcardContainer.classList.remove('hidden');
        }

        flipBtn.addEventListener('click', () => {
            flashcard.classList.toggle('flip');
        });

        nextBtn.addEventListener('click', () => {
            if(!answer.classList.contains("hidden")){
                answer.classList.add('hidden');
                question.classList.remove("hidden");
            }
            currentCard = (currentCard + 1) % flashcards.length;
            showCard();
        });

        showCard();
    }    
});


    </script>
{% endblock %}